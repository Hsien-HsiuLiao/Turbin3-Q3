; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

[env:arduino_nano_esp32]
platform = espressif32
board = arduino_nano_esp32
framework = arduino
monitor_speed = 115200

;upload_flags = -c esptool

; Use esptool directly for upload to avoid device disappearing issue
upload_protocol = esptool
upload_speed = 460800

; Add upload flags to handle device disconnection during upload
upload_flags = 
    --chip=esp32s3
    --port=$UPLOAD_PORT
    --baud=$UPLOAD_SPEED
    --before=default_reset
    --after=hard_reset
    write_flash
    --flash_mode=dio
    --flash_freq=80m
    --flash_size=8MB
    0x0
    $SOURCE

; Alternative configuration for problematic uploads (slower but more reliable)
[env:arduino_nano_esp32_slow]
platform = espressif32
board = arduino_nano_esp32
framework = arduino
monitor_speed = 115200
upload_protocol = esptool
upload_speed = 115200
upload_flags = 
    --chip=esp32s3
    --port=$UPLOAD_PORT
    --baud=115200
    --before=default_reset
    --after=hard_reset
    write_flash
    --flash_mode=dio
    --flash_freq=40m
    --flash_size=8MB
    0x0
    $SOURCE

; Manual upload configuration - use this if automatic upload fails
[env:arduino_nano_esp32_manual]
platform = espressif32
board = arduino_nano_esp32
framework = arduino
monitor_speed = 115200
upload_protocol = esptool ;esp-builtin ;
upload_speed = 115200
;upload_flags = 
;    --chip=esp32s3
;    --port=$UPLOAD_PORT
;    --baud=115200
;    --before=no_reset
;    --after=hard_reset
;    write_flash
;    --flash_mode=dio
;    --flash_freq=40m
;    --flash_size=8MB
;    0x0
;   $SOURCE    
;    --connect-attempts=3
